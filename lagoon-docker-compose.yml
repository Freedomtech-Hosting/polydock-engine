services:
    mariadb:
        image: uselagoon/mysql-8.0
        labels:
            lagoon.type: mariadb
        environment:
            SERVICE_NAME: worker
    redis:
        build:
            context: .
            dockerfile: lagoon/redis.dockerfile
        image: uselagoon/redis-7-persistent
        labels:
            lagoon.type: redis-persistent
#   meilisearch:
#       image: 'getmeili/meilisearch:latest'
#       labels:
#           lagoon.type: basic-persistent
#           lagoon.persistent: /meili_data
#           lagoon.service.port: 7700
#           lagoon.autogeneratedroute: false
    cli:
        build:
            context: .
            dockerfile: lagoon/cli.dockerfile
        image: sailonlagoon
        labels:
            lagoon.type: cli-persistent
            lagoon.persistent.name: nginx
            lagoon.persistent: /app/storage
        depends_on:
            - redis
            - meilisearch
    nginx:
        build:
            context: .
            dockerfile: lagoon/nginx.dockerfile
            args:
                CLI_IMAGE: sailonlagoon
        labels:
            lagoon.type: nginx-php-persistent
            lagoon.name: nginx
            lagoon.persistent: /app/storage
        volumes:
            - './:/app:delegated'
        depends_on:
            - cli
            - redis
    php:
        build:
            context: .
            dockerfile: lagoon/php.dockerfile
            args:
                CLI_IMAGE: sailonlagoon
        labels:
            lagoon.type: nginx-php-persistent
            lagoon.name: nginx
            lagoon.persistent: /app/storage/
        volumes:
            - './:/app:delegated'
